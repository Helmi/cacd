<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>CCManager Web POC</title>
		<link
			rel="stylesheet"
			href="https://unpkg.com/xterm/css/xterm.css"
		/>
		<style>
			html,
			body {
				height: 100%;
				margin: 0;
				background: #0b0e14;
				color: #e6e6e6;
				font-family: system-ui, sans-serif;
			}
			#bar {
				padding: 8px 12px;
				background: #11151d;
				border-bottom: 1px solid #222a36;
				font-size: 13px;
			}
			#terminal {
				height: calc(100% - 33px);
				width: 100%;
			}
		</style>
	</head>
	<body>
		<div id="bar">
			CCManager Web POC (no auth; LAN only) â€” open a worktree in another
			tab/terminal and start `claude`/`codex` there if you want.
		</div>
		<div id="terminal"></div>

		<script src="https://unpkg.com/xterm/lib/xterm.js"></script>
		<script>
			const term = new Terminal({
				cursorBlink: true,
				convertEol: true,
				fontFamily:
					'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace',
				theme: {
					background: '#0b0e14',
				},
			});
			term.open(document.getElementById('terminal'));
			term.focus();

			const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
			const ws = new WebSocket(`${proto}//${location.host}`);

			ws.addEventListener('open', () => {
				term.writeln('\r\n[connected]\r\n');
			});

			ws.addEventListener('message', ev => {
				let msg;
				try {
					msg = JSON.parse(ev.data);
				} catch {
					return;
				}
				if (msg.type === 'pty_output') {
					term.write(msg.data);
				}
				if (msg.type === 'info') {
					term.writeln(`\r\n[info] ${msg.data}\r\n`);
				}
			});

			ws.addEventListener('close', () => {
				term.writeln('\r\n[disconnected]\r\n');
			});

			term.onData(data => {
				if (ws.readyState === WebSocket.OPEN) {
					ws.send(JSON.stringify({type: 'pty_input', data}));
				}
			});

			function sendResize() {
				const cols = term.cols;
				const rows = term.rows;
				if (ws.readyState === WebSocket.OPEN) {
					ws.send(JSON.stringify({type: 'resize', cols, rows}));
				}
			}
			window.addEventListener('resize', () => {
				setTimeout(sendResize, 50);
			});
			setTimeout(sendResize, 200);
		</script>
	</body>
</html>

